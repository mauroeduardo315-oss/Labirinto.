<!DOCTYPE html>
<html lang="pt-BR">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffcc00">
<meta charset="UTF-8">
<title>Labirinto do Amor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: 'Arial', sans-serif;
  background: #111;
  color: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px;
}
h1 { color: #ffcc00; text-align: center; }
#score { font-size: 20px; margin: 10px 0; color: #00ff99; }
.tabs { display: flex; gap: 20px; margin-bottom: 20px; cursor: pointer; }
.tab { padding: 10px 20px; border-radius: 5px; background: #222; transition: 0.3s; }
.tab.active { background: #ffcc00; color: #000; font-weight: bold; }
#maze, #store, #specialStore { width: 100%; }
#maze {
  display: grid;
  grid-template-columns: repeat(11, 40px);
  grid-template-rows: repeat(11, 40px);
  gap: 2px;
  margin-bottom: 20px;
}
.cell { width: 40px; height: 40px; background: #222; display: flex; align-items: center; justify-content: center; font-size: 28px; border-radius: 5px; }
.wall { background: #555; }
.player { color: red; }
.exit { background: #00ff99; font-weight: bold; }
/* Ajuste do teclado */
.controls {
  display: grid;
  grid-template-columns: repeat(3, 60px);
  gap: 10px;
  justify-content: center; /* centraliza horizontalmente */
  margin-bottom: 20px;
}
.btn { width: 50px; height: 50px; background: #ffcc00; border: none; border-radius: 8px; font-size: 24px; font-weight: bold; color: #000; }
.btn:active { background: #ffaa00; }
.store, #specialStore { margin-top: 20px; text-align: center; }
/* Ajuste dos tickets na aba especial */
.ticket {
  display: inline-block;
  background: #ffcc00;
  color: #000;
  padding: 10px 15px; /* mais espa√ßo para o texto */
  margin: 10px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  max-width: 200px;
  word-wrap: break-word; /* for√ßa quebra de linha se necess√°rio */
  text-align: center; /* centraliza o texto */
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  transition: 0.3s;
}
.ticket:hover { background: #ffaa00; }
#redeemed { margin-top: 20px; }
.redeemed-ticket { background: #fff; color: #000; padding: 10px; margin: 5px auto; border-radius: 8px; max-width: 250px; }
</style>
</head>
<body>
<h1>Labirinto do Amor üíõ</h1>
<div id="score">Pontos: 0</div>

<div class="tabs">
  <div class="tab active" onclick="showTab('mazeTab')">Labirinto</div>
  <div class="tab" onclick="showTab('specialTab')">Pr√™mios Sapecagens</div>
</div>

<div id="mazeTab">
  <div id="maze"></div>
  <div class="controls">
    <div></div>
    <button class="btn" onclick="move('up')">‚Üë</button>
    <div></div>
    <button class="btn" onclick="move('left')">‚Üê</button>
    <button class="btn" onclick="move('down')">‚Üì</button>
    <button class="btn" onclick="move('right')">‚Üí</button>
    <div></div>
  </div>

  <div class="store">
    <h2>üéüÔ∏è Troque seus pontos üéüÔ∏è</h2>
    <div class="ticket" onclick="redeem(1,'Vale 2 Beijo ')">Vale 1 Beijo - 2 pt</div>
    <div class="ticket" onclick="redeem(0,'Vale 0 Abra√ßo ')">Vale 1 Abra√ßo - 0 pts</div>
    <div class="ticket" onclick="redeem(15,'Vale massagem ')">Vale 1 massagem nas costas - 30 pts</div>
    <div class="ticket" onclick="redeem(15,'Vale massagem nos p√©s ')">Vale 1 massagem nos p√©s - 30 pts</div>
    <div class="ticket" onclick="redeem(40,'Vale caf√© na cama')">Vale 1 caf√© da manh√£ - 40 pts</div>
    <div class="ticket" onclick="redeem(50 ,'Vale um jantar feito por mim')">Vale 1 jantar - 50 pontos</div>
    <div class="ticket" onclick="redeem(1000,'nao adiantar ver no c√≥digo, √© surpresa üòÄ')">Vale 1 pr√™mio surpresa - 1000 pts</div>
  </div>
</div>

<div id="specialTab" style="display:none;">
  <div id="specialStore">
    <h2> Pr√™mios sobre Sapecagens </h2>
    <div class="ticket" onclick="redeem(10,'vale dedada at√© voc√™ gozar')">10 pts</div>
    <div class="ticket" onclick="redeem(15,'vale sapecagem na posi√ß√£o que voc√™ quiser.')">15 pts</div>
    <div class="ticket" onclick="redeem(20,'Vale uma chupada at√© voc√™ gozar')">20 pts</div>
    <div class="ticket" onclick="redeem(30,'Vale uma chupada + dedos at√© gozar')">30 pts</div>
  </div>
</div>

<div id="redeemed">
<h3>Ingressos resgatados:</h3>
</div>

<script>
let points = 0;
let playerPos = {x:1, y:1};

// Labirinto base 11x11
const baseMaze = [
  [1,1,1,1,1,1,1,1,1,1,1],
  [1,0,1,0,0,0,1,0,0,0,1],
  [1,0,1,0,1,0,1,0,1,0,1],
  [1,0,0,0,1,0,0,0,1,0,1],
  [1,1,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,1,0,0,0,1],
  [1,0,1,1,1,0,1,1,1,0,1],
  [1,0,1,0,0,0,0,0,1,0,1],
  [1,0,1,0,1,1,1,0,1,0,1],
  [1,0,0,0,0,0,0,0,0,2,1],
  [1,1,1,1,1,1,1,1,1,1,1]
];
let mazeData = JSON.parse(JSON.stringify(baseMaze));

function renderMaze() {
  const maze = document.getElementById('maze');
  maze.innerHTML = '';
  for(let y=0; y<mazeData.length; y++){
    for(let x=0; x<mazeData[y].length; x++){
      const cell = document.createElement('div');
      cell.classList.add('cell');
      if(mazeData[y][x]===1) cell.classList.add('wall');
      if(mazeData[y][x]===2) cell.classList.add('exit');
      if(playerPos.x===x && playerPos.y===y) cell.textContent='‚ù§Ô∏è';
      maze.appendChild(cell);
    }
  }
}

// DFS para caminho seguro
function hasPath(x,y,visited){
  if(x<0||y<0||y>=mazeData.length||x>=mazeData[0].length) return false;
  if(mazeData[y][x]===1) return false;
  if(visited[y][x]) return false;
  visited[y][x]=true;
  if(mazeData[y][x]===2) return true;
  return hasPath(x+1,y,visited)||hasPath(x-1,y,visited)||hasPath(x,y+1,visited)||hasPath(x,y-1,visited);
}
// Atualizar pontos e salvar
function updateScore(){
  document.getElementById('score').textContent="Pontos: "+points;
  localStorage.setItem('labirintoPoints', points);
}
// --- 1. Recuperar progresso ao carregar ---
window.onload = function() {
  // Pontos
  const savedPoints = localStorage.getItem('labirintoPoints');
  if(savedPoints) points = parseInt(savedPoints);

  // Tickets resgatados
  const savedTickets = JSON.parse(localStorage.getItem('redeemedTickets') || '[]');
  const redeemedDiv = document.getElementById('redeemed');
  savedTickets.forEach(ticket => {
    const div = document.createElement('div');
    div.classList.add('redeemed-ticket');
    div.textContent = ticket;
    redeemedDiv.appendChild(div);
  });

  updateScore();
  renderMaze();
};

// --- 2. Atualizar pontos e salvar ---
function updateScore(){
  document.getElementById('score').textContent="Pontos: "+points;
  localStorage.setItem('labirintoPoints', points);
}

// --- 3. Resgatar ticket e salvar ---
function redeem(cost, prize){
  if(points >= cost){
    points -= cost;
    updateScore();

    // Criar ticket resgatado
    const div = document.createElement('div');
    div.classList.add('redeemed-ticket');
    div.textContent = prize;
    document.getElementById('redeemed').appendChild(div);

    // Salvar no localStorage
    let savedTickets = JSON.parse(localStorage.getItem('redeemedTickets') || '[]');
    savedTickets.push(prize);
    localStorage.setItem('redeemedTickets', JSON.stringify(savedTickets));

  } else {
    alert('‚ö†Ô∏è Voc√™ n√£o tem pontos suficientes!');
  }
}
// Randomiza√ß√£o leve
function randomizeMaze(){
  mazeData = JSON.parse(JSON.stringify(baseMaze));
  for(let y=1;y<mazeData.length-1;y++){
    for(let x=1;x<mazeData[y].length-1;x++){
      if(mazeData[y][x]===0 && Math.random()<0.15){
        mazeData[y][x]=1;
        const testVisited = Array.from({length:mazeData.length},()=>Array(mazeData[0].length).fill(false));
        if(!hasPath(1,1,testVisited)) mazeData[y][x]=0;
      } else if(mazeData[y][x]===1 && Math.random()<0.05){
        mazeData[y][x]=0;
      }
    }
  }
  playerPos={x:1,y:1};
  renderMaze();
}

// Movimenta√ß√£o
function move(dir){
  let newX=playerPos.x;
  let newY=playerPos.y;
  if(dir==='up') newY--;
  if(dir==='down') newY++;
  if(dir==='left') newX--;
  if(dir==='right') newX++;
  if(mazeData[newY][newX]!==1){
    playerPos={x:newX,y:newY};
    if(mazeData[newY][newX]===2){
      points++;
      alert('üéâ Voc√™ completou o labirinto e ganhou 1 ponto!');
      updateScore();
      randomizeMaze();
    }
    renderMaze();
  }
}

// Teclado f√≠sico
document.addEventListener('keydown',(e)=>{
  if(e.key==='ArrowUp') move('up');
  if(e.key==='ArrowDown') move('down');
  if(e.key==='ArrowLeft') move('left');
  if(e.key==='ArrowRight') move('right');
});

function updateScore(){
  document.getElementById('score').textContent="Pontos: "+points;
}

function redeem(cost,prize){
  if(points>=cost){
    points-=cost;
    updateScore();
    const div=document.createElement('div');
    div.classList.add('redeemed-ticket');
    div.textContent=prize;
    document.getElementById('redeemed').appendChild(div);
  } else {
    alert('‚ö†Ô∏è Voc√™ n√£o tem pontos suficientes!');
  }
}

// Alternar abas
function showTab(tabId){
  document.getElementById('mazeTab').style.display = 'none';
  document.getElementById('specialTab').style.display = 'none';
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  if(tabId==='mazeTab'){
    document.getElementById('mazeTab').style.display='block';
    document.querySelector('.tab:nth-child(1)').classList.add('active');
  } else {
    document.getElementById('specialTab').style.display='block';
    document.querySelector('.tab:nth-child(2)').classList.add('active');
  }
}

randomizeMaze();

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker registrado'))
    .catch(err => console.log('Erro SW:', err));
}


</script>
</body>
</html>